	adapter speed 100
	reset_config trst_and_srst
	set _CHIPNAME K1921VG7T
	
	jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0xDEB14001

	#set _DAPNAME $_CHIPNAME.dap
	set _TARGETNAME $_CHIPNAME.cpu

	#dap create $_DAPNAME -chain-position $_TARGETNAME
	target create $_TARGETNAME riscv -endian little -chain-position $_TARGETNAME -coreid 0
	
# Work-area is a space in RAM used for flash programming
if { [info exists WORKAREASIZE] } {
   set _WORKAREASIZE $WORKAREASIZE
} else {
   set _WORKAREASIZE 0x8000
}

$_TARGETNAME configure -work-area-phys 0x20000000 -work-area-size $_WORKAREASIZE -work-area-backup 0

flash bank $_CHIPNAME.flash k1921vg7t 0x0 0 0 16 $_TARGETNAME

proc k1921vg7t_sw_reset {} { 
	echo "SW Reset by RCU->RSTSYS"
    mww 0x50004030  0xa55a0001
	adapter speed 1000
}

proc sw_reset_halt {} {
	reset halt
}

#$_TARGETNAME configure -event gdb-attach { reset init }
#$_TARGETNAME configure -event reset-init { k1921vg7t_sw_reset }
